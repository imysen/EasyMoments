import{r as s,j as e,C as k,c as L,d as P,e as R,I as v,B as _,h as E,m as K}from"./api-Djm3PB4m.js";import{u as O,T as B}from"./use-config-DCEOYtYw.js";import{L as S}from"./label-DIN_m3m4.js";function F(){const{config:d}=O(),i=!!d?.turnstile_enabled,b=d?.turnstile_site_key||"",c=new URLSearchParams(window.location.search).get("token")||"",[l,u]=s.useState(""),[m,p]=s.useState(""),[x,n]=s.useState(""),[C,h]=s.useState(0),[f,j]=s.useState(!1),[g,a]=s.useState(""),[w,y]=s.useState("");async function N(t){if(t.preventDefault(),a(""),y(""),!c)return a("缺少重置 token");if(i&&!x)return a("请完成验证码验证");j(!0);try{const r=await fetch("/api/auth/reset-password",{method:"POST",headers:E("POST"),body:JSON.stringify({token:c,new_password:l,totp_code:m,"cf-turnstile-response":x})}),T=await r.json();if(!r.ok)throw n(""),h(o=>o+1),new Error(T?.error||"重置失败");y("密码重置成功，请重新登录。"),u(""),p(""),n(""),h(o=>o+1)}catch(r){a(String(r?.message||r))}finally{j(!1)}}return e.jsx("div",{className:"min-h-dvh bg-muted/20",children:e.jsx("main",{className:"mx-auto flex max-w-5xl justify-center px-4 py-10",children:e.jsxs(k,{className:"w-full max-w-md",children:[e.jsx(L,{children:e.jsx(P,{children:"重置密码"})}),e.jsx(R,{children:e.jsxs("form",{className:"space-y-4",onSubmit:N,children:[g?e.jsx("div",{className:"rounded-md border border-destructive/50 bg-destructive/5 p-3 text-sm text-destructive",children:g}):null,w?e.jsx("div",{className:"rounded-md border bg-muted/40 p-3 text-sm",children:w}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"reset-password",children:"新密码"}),e.jsx(v,{id:"reset-password",type:"password",autoComplete:"new-password",value:l,onChange:t=>u(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"reset-totp",children:"双重验证码 (若开启)"}),e.jsx(v,{id:"reset-totp",type:"text",inputMode:"numeric",maxLength:6,autoComplete:"one-time-code",value:m,onChange:t=>p(t.target.value)})]}),e.jsx(B,{enabled:i,siteKey:b,onToken:n,resetKey:C}),e.jsx(_,{className:"w-full",type:"submit",disabled:f,children:f?"处理中...":"重置密码"}),e.jsx("div",{className:"text-sm",children:e.jsx("a",{className:"text-muted-foreground hover:underline",href:"/login",children:"返回登录"})})]})})]})})})}K("root",e.jsx(F,{}));
