import{r as s,j as l}from"./api-Djm3PB4m.js";async function f(){window.turnstile||await new Promise((e,i)=>{const n=document.querySelector('script[data-turnstile="1"]');if(n){n.addEventListener("load",()=>e()),n.addEventListener("error",()=>i(new Error("Turnstile 脚本加载失败")));return}const t=document.createElement("script");t.src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit",t.async=!0,t.defer=!0,t.dataset.turnstile="1",t.addEventListener("load",()=>e()),t.addEventListener("error",()=>i(new Error("Turnstile 脚本加载失败"))),document.head.appendChild(t)})}function p({enabled:e,siteKey:i,onToken:n,resetKey:t}){const r=`turnstile-${s.useId().replace(/[:]/g,"")}`,c=s.useRef(null);return s.useEffect(()=>{if(!e)return;let o=!1;return(async()=>{if(await f(),o)return;const a=document.getElementById(r);!a||!window.turnstile||(a.innerHTML="",c.current=window.turnstile.render(a,{sitekey:i,callback:d=>n(d)}))})().catch(()=>{}),()=>{o=!0}},[e,i,r,n,t]),s.useEffect(()=>{e&&window.turnstile&&c.current&&window.turnstile.reset(c.current)},[e,t]),e?l.jsx("div",{id:r,className:"my-4"}):null}function E(){const[e,i]=s.useState(null),[n,t]=s.useState("");return s.useEffect(()=>{let u=!1;return(async()=>{try{const r=await fetch("/api/config");if(!r.ok)throw new Error("无法加载站点配置");const c=await r.json();u||i(c)}catch(r){u||t(String(r?.message||r))}})(),()=>{u=!0}},[]),{config:e,error:n}}export{p as T,E as u};
