import{r as s,j as e,C as N,c as k,d as E,e as _,I as o,B as L,h as P,s as R,i as F,m as K}from"./api-Djm3PB4m.js";import{u as O,T as I}from"./use-config-DCEOYtYw.js";import{L as i}from"./label-DIN_m3m4.js";function q(){const{config:l}=O(),[d,j]=s.useState(""),[c,y]=s.useState(""),[u,v]=s.useState(""),[m,h]=s.useState(""),[w,C]=s.useState(0),[x,p]=s.useState(!1),[g,a]=s.useState(""),f=!!l?.turnstile_enabled,S=l?.turnstile_site_key||"";async function T(t){if(t.preventDefault(),a(""),f&&!m){a("请完成验证码验证");return}p(!0);try{const r=await fetch("/api/login",{method:"POST",headers:P("POST"),body:JSON.stringify({email:d,password:c,totp_code:u,"cf-turnstile-response":m})}),n=await r.json();if(!r.ok){if(h(""),C(b=>b+1),n?.error==="TOTP_REQUIRED"){a("请输入 2FA 验证码");return}throw new Error(n?.error||"登录失败")}R(n.user),F(n.token),window.location.href="/"}catch(r){a(String(r?.message||r))}finally{p(!1)}}return e.jsx("div",{className:"min-h-dvh bg-muted/20",children:e.jsx("main",{className:"mx-auto flex max-w-5xl justify-center px-4 py-10",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsx(k,{children:e.jsx(E,{children:"登录"})}),e.jsx(_,{children:e.jsxs("form",{className:"space-y-4",onSubmit:T,children:[g?e.jsx("div",{className:"rounded-md border border-destructive/50 bg-destructive/5 p-3 text-sm text-destructive",children:g}):null,e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"login-email",children:"邮箱"}),e.jsx(o,{id:"login-email",name:"email",type:"email",autoComplete:"username",value:d,onChange:t=>j(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"login-password",children:"密码"}),e.jsx(o,{id:"login-password",name:"password",type:"password",autoComplete:"current-password",value:c,onChange:t=>y(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"login-totp",children:"双重验证码 (若开启)"}),e.jsx(o,{id:"login-totp",name:"totp_code",type:"text",inputMode:"numeric",pattern:"\\d*",maxLength:6,placeholder:"选填",autoComplete:"one-time-code",value:u,onChange:t=>v(t.target.value)})]}),e.jsx(I,{enabled:f,siteKey:S,onToken:h,resetKey:w}),e.jsx(L,{className:"w-full",type:"submit",disabled:x,children:x?"处理中...":"登录"}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("a",{className:"text-muted-foreground hover:underline",href:"/register",children:"没有账号？注册"}),e.jsx("a",{className:"text-muted-foreground hover:underline",href:"/forgot",children:"忘记密码？"})]})]})})]})})})}K("root",e.jsx(q,{}));
